<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Add Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('food-waste-bg.jpg');
            background-size: cover;
            background-position: center;
        }

        .signup-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 550px;

            transition: transform 0.3s ease;
        }

        .signup-container:hover {
            transform: translateY(-5px);
        }

        .name-group {
            display: flex;
            gap: 15px;
        }

        .name-group .form-group {
            flex: 1;
        }

        .password-strength {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .strength-indicator {
            flex: 1;
            height: 5px;
            background: #eee;
            border-radius: 3px;
            overflow: hidden;
        }

        .strength-bar {
            height: 100%;
            width: 0;
            transition: width 0.3s ease, background-color 0.3s ease;
        }

        .password-rules {
            margin-top: 5px;
            font-size: 0.8rem;
            color: #7f8c8d;
        }

        .signup-btn {
            width: 100%;
            padding: 14px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .signup-btn:hover {
            background: #219653;
        }

        .form-group {
            padding-top: 12px;
            padding-left: 8px;
        }

        .input-icon {
            position: relative;
            display: flex;
            align-items: center;
            background: #f4f4f4;
            padding: 10px;
            border-radius: 8px;
            gap: 10px;
            margin-top: 5px;
        }

        .input-icon i {
            color: #888;
        }

        .input-icon input,
        .input-icon select {
            border: none;
            outline: none;
            background: transparent;
            width: 100%;
            font-size: 1rem;
        }

        .login-link {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .login-link a {
            color: #27ae60;
            text-decoration: none;
        }

        .alert {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            display: none;
        }

        .alert.success {
            background-color: #d4edda;
            color: #155724;
        }

        .alert.error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>

<body>
    <div class="signup-container">
        <% if (error) { %>
            <div class="alert error">
                <%= error %>
            </div>
            <% } %>
                <% if (success) { %>
                    <div class="alert success">
                        <%= success %>
                    </div>
                    <% } %>

                        <div class="logo">
                            <i class="fas fa-seedling"></i>
                            <h1>Create FoodSave Account</h1>
                        </div>
                        <form id="signupForm" method="POST" action="/signup">
                            <!-- User Role moved to top -->
                            <div class="form-group">
                                <label>User Role</label>
                                <div class="input-icon">
                                    <i class="fas fa-user-tag"></i>
                                    <select id="userRole" name="role" required>
                                        <option value="">Select a role</option>
                                        <option value="admin">Admin</option>
                                        <option value="donor">Donor</option>
                                        <option value="receiver">Receiver</option>
                                    </select>
                                </div>
                            </div>

                            <div class="name-group">
                                <div class="form-group">
                                    <label>First Name</label>
                                    <div class="input-icon">
                                        <i class="fas fa-user"></i>
                                        <input type="text" name="firstName" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Last Name</label>
                                    <div class="input-icon">
                                        <i class="fas fa-user"></i>
                                        <input type="text" name="lastName" required>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Email Address</label>
                                <div class="input-icon">
                                    <i class="fas fa-envelope"></i>
                                    <input type="email" name="email" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Password</label>
                                <div class="input-icon">
                                    <i class="fas fa-lock"></i>
                                    <input type="password" name="password" required>
                                    <i class="fas fa-eye show-password" id="togglePassword"></i>
                                </div>
                                <div class="password-strength">
                                    <span>Strength:</span>
                                    <div class="strength-indicator">
                                        <div class="strength-bar" id="strengthBar"></div>
                                    </div>
                                </div>
                                <div class="password-rules">
                                    Must be at least 8 characters with a number and special character
                                </div>
                            </div>

                            <button type="submit" class="signup-btn">Create Account</button>
                        </form>

                        <div class="login-link">
                            Already have an account? <a href="login">Log In</a>
                        </div>
    </div>
<script>
    const togglePassword = document.querySelector('#togglePassword');
    const password = document.querySelector('input[name="password"]');
    const strengthBar = document.querySelector('#strengthBar');
    const form = document.querySelector('#signupForm');
    
    togglePassword.addEventListener('click', () => {
        const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
        password.setAttribute('type', type);
        togglePassword.classList.toggle('fa-eye-slash');
    });
    
    password.addEventListener('input', () => {
        const strength = calculatePasswordStrength(password.value);
        strengthBar.style.width = strength.percentage + '%';
        strengthBar.style.backgroundColor = strength.color;
    });
    
    form.addEventListener('submit', async (e) => {
        e.preventDefault(); // Prevent default form submission to handle via JavaScript
    
        const formData = new FormData(form);
        const data = {};
    
        formData.forEach((value, key) => {
            data[key] = value;
        });
    
        try {
            const response = await fetch('/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json', // Ensure the request is in JSON format
                },
                body: JSON.stringify(data), // Send form data as JSON
            });
    
            const result = await response.json();
            console.log(result); // Debugging log
    
            if (result.success) {
                window.location.href = '/login'; // Redirect to login page after successful signup
            } else {
                // Display error message if something goes wrong
                showAlert(result.error, 'error');
            }
        } catch (err) {
            showAlert('An error occurred while creating your account.', 'error');
        }
    });
    
    // Function to display alert messages
    function showAlert(message, type) {
        const alert = document.createElement('div');
        alert.className = `alert ${type}`;
        alert.textContent = message;
        document.querySelector('.signup-container').insertBefore(alert, form);
    }
    
    // Function to calculate password strength
    function calculatePasswordStrength(password) {
        let strength = 0;
        if (password.length >= 8) strength += 40;
        if (password.match(/[A-Z]/)) strength += 20;
        if (password.match(/[0-9]/)) strength += 20;
        if (password.match(/[^A-Za-z0-9]/)) strength += 20;
    
        return {
            percentage: strength > 100 ? 100 : strength,
            color: strength >= 80 ? '#27ae60' : strength >= 50 ? '#f1c40f' : '#e74c3c'
        };
    }
</script>
</body>

</html>