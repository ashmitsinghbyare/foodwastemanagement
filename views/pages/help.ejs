<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= title %> - FoodSave</title>
  <link rel="stylesheet" href="/css/help.css" />
</head>
<body>

  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="nav-logo">
      <a href="/home">FoodSave</a>
    </div>
    <div class="nav-links">
      <a href="/home">Home</a>
      <a href="/help" class="active">Help Center</a>
      <a href="/contact">Contact Us</a>
      <button class="live-chat-btn" onclick="toggleChat()">Chat with Agent</button>
    </div>
  </nav>

  <main class="container">
    <header class="help-header">
      <h1>Help Center</h1>
      <p>Find answers to common questions about FoodSave and how to use our food waste management system effectively.</p>
    </header>

    <!-- Search Help Articles -->
    <div class="search-help">
      <input type="text" id="helpSearch" placeholder="Search help articles..." />
      <button onclick="searchHelp()">Search</button>
    </div>

    <!-- Help Categories (EJS Rendered) -->
    <section id="helpCategories">
      <div class="category">
        <h3>Getting Started</h3>
        <ul>
          <li>
            <a href="#" onclick="loadArticle('1'); return false;">
              How to Create an Account
            </a>
          </li>
          <li>
            <a href="#" onclick="loadArticle('2'); return false;">
              How to Track Your Food Waste
            </a>
          </li>
        </ul>
      </div>

      <div class="category">
        <h3>Waste Reduction Tips</h3>
        <ul>
          <li>
            <a href="#" onclick="loadArticle('3'); return false;">
              5 Ways to Reduce Food Waste
            </a>
          </li>
          <li>
            <a href="#" onclick="loadArticle('4'); return false;">
              How to Use Leftovers Effectively
            </a>
          </li>
        </ul>
      </div>

      <div class="category">
        <h3>Account Management</h3>
        <ul>
          <li>
            <a href="#" onclick="loadArticle('5'); return false;">
              How to Change Your Password
            </a>
          </li>
          <li>
            <a href="#" onclick="loadArticle('6'); return false;">
              How to Delete Your Account
            </a>
          </li>
          <li>
            <a href="#" onclick="loadArticle('7'); return false;">
              How to Reset Your Password
            </a>
          </li>
        </ul>
      </div>

      <div class="category">
        <h3>Contact Support</h3>
        <ul>
          <li>
            <a href="#" onclick="loadArticle('8'); return false;">
              How to Contact Support
            </a>
          </li>
        </ul>
      </div>
    </section>

    <!-- Article Detail View -->
    <article id="articleContent" class="article-content" style="display: none;"></article>

    <!-- Additional Help Section -->
    <section class="still-need-help">
      <h2>Still need help?</h2>
      <div class="help-options">
        <a href="/contact" class="btn">Contact Support</a>
        <button class="btn btn-chat" onclick="toggleChat()">Start Live Chat</button>
      </div>
    </section>
  </main>

  <!-- Chat Widget -->
  <div id="chatWidget" class="chat-widget" style="display: none;">
    <div class="chat-header">
      <span>Chat with an Agent</span>
      <button class="close-chat" onclick="toggleChat()">×</button>
    </div>
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-input-area">
      <textarea id="chatInput" class="chat-input" placeholder="Type your message..."></textarea>
      <button class="chat-send-btn" onclick="sendMessage()">Send</button>
    </div>
  </div>

  <!-- JS Logic -->
  <script>
    function searchHelp() {
      const searchTerm = document.getElementById('helpSearch').value.toLowerCase();
      const categories = document.querySelectorAll('.category');

      categories.forEach(category => {
        let matchFound = false;
        const items = category.querySelectorAll('li');

        items.forEach(item => {
          const text = item.textContent.toLowerCase();
          const isMatch = text.includes(searchTerm);
          item.style.display = isMatch ? 'list-item' : 'none';
          if (isMatch) matchFound = true;
        });

        category.style.display = matchFound ? 'block' : 'none';
      });
    }

    function loadArticle(id) {
      const articles = {
        '1': { title: 'How to Create an Account', content: 'To create an account, click the "Sign Up" button and provide basic details like email, name, and password.' },
        '2': { title: 'How to Track Your Food Waste', content: 'Go to the "Track Waste" tab to log food waste details like food type, quantity, and reason.' },
        '3': { title: '5 Ways to Reduce Food Waste', content: '1. Plan meals. 2. Store food properly. 3. Use leftovers. 4. Compost. 5. Educate others.' },
        '4': { title: 'How to Use Leftovers Effectively', content: 'Repurpose leftover vegetables into soups, or turn stale bread into croutons or breadcrumbs.' },
        '5': { title: 'How to Change Your Password', content: 'Go to "Settings", click "Change Password", and enter your new password.' },
        '6': { title: 'How to Delete Your Account', content: 'Go to "Settings", click "Delete Account", and confirm your decision. This is irreversible.' },
        '7': { title: 'How to Reset Your Password', content: 'Click "Forgot Password" on the login page, enter your email, and follow the instructions sent to you.' },
        '8': { title: 'How to Contact Support', content: 'You can reach support by clicking the "Contact Us" button or via the live chat widget for immediate help.' }
      };

      const article = articles[id];
      if (article) {
        const contentDiv = document.getElementById('articleContent');
        contentDiv.innerHTML = `
          <h3>${article.title}</h3>
          <p>${article.content}</p>
          <button onclick="closeArticle()" class="close-article">× Close</button>
        `;
        contentDiv.style.display = 'block';
        contentDiv.scrollIntoView({ behavior: 'smooth' });
      }
    }

    function closeArticle() {
      document.getElementById('articleContent').style.display = 'none';
    }

    function toggleChat() {
      const chatWidget = document.getElementById('chatWidget');
      chatWidget.style.display = chatWidget.style.display === 'block' ? 'none' : 'block';
    }

    function sendMessage() {
      const input = document.getElementById('chatInput');
      const chatBody = document.getElementById('chatBody');
      const msg = input.value.trim();
      if (!msg) return;

      const msgDiv = document.createElement('div');
      msgDiv.className = 'chat-message user';
      msgDiv.innerHTML = `<strong>You:</strong> ${msg}`;
      chatBody.appendChild(msgDiv);
      input.value = '';
      chatBody.scrollTop = chatBody.scrollHeight;

      setTimeout(() => {
        const reply = document.createElement('div');
        reply.className = 'chat-message support';
        reply.innerHTML = `<strong>Support:</strong> We'll get back to you shortly!`;
        chatBody.appendChild(reply);
        chatBody.scrollTop = chatBody.scrollHeight;
      }, 1000);
    }

    let lastScrollTop = 0;
    const navbar = document.querySelector('.navbar');

    window.addEventListener("scroll", function () {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      navbar.style.top = scrollTop > lastScrollTop ? "-100px" : "0";
      lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
    });
  </script>
</body>
</html>
