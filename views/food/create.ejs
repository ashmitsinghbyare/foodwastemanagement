<%- include('../partials/header') %>

<div class="container">
  <div class="section-heading">
    <h1>Create Food Listing</h1>
    <p>Share your surplus food with those in need</p>
  </div>
  
  <div class="form-container food-form">
    <form action="/donor/foods" method="POST" enctype="multipart/form-data">
      <div class="row">
        <div class="col-md-7">
          <h3>Food Information</h3>
          
          <div class="form-group">
            <label for="title" class="form-label">Title <span class="text-danger">*</span></label>
            <input type="text" id="title" name="title" class="form-control" required placeholder="E.g., Homemade Lasagna, Fresh Vegetables, etc.">
          </div>
          
          <div class="form-group">
            <label for="description" class="form-label">Description <span class="text-danger">*</span></label>
            <textarea id="description" name="description" class="form-control" rows="4" required placeholder="Describe the food, including ingredients and any allergens"></textarea>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="category" class="form-label">Category <span class="text-danger">*</span></label>
                <select id="category" name="category" class="form-control" required>
                  <option value="">Select Category</option>
                  <option value="cooked food">Cooked Food</option>
                  <option value="raw food">Raw Food</option>
                  <option value="packaged food">Packaged Food</option>
                  <option value="fruits">Fruits</option>
                  <option value="vegetables">Vegetables</option>
                  <option value="bread">Bread & Bakery</option>
                  <option value="dairy">Dairy Products</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="expiryDate" class="form-label">Expiry Date <span class="text-danger">*</span></label>
                <input type="date" id="expiryDate" name="expiryDate" class="form-control" required>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="quantity" class="form-label">Quantity <span class="text-danger">*</span></label>
                <input type="number" id="quantity" name="quantity" class="form-control" required min="1">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="unit" class="form-label">Unit <span class="text-danger">*</span></label>
                <select id="unit" name="unit" class="form-control" required>
                  <option value="">Select Unit</option>
                  <option value="servings">Servings</option>
                  <option value="kg">Kilograms (kg)</option>
                  <option value="lb">Pounds (lb)</option>
                  <option value="pieces">Pieces</option>
                  <option value="packages">Packages</option>
                  <option value="boxes">Boxes</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="foodImages" class="form-label">Food Images</label>
            <input type="file" id="foodImages" name="foodImages" class="form-control" accept="image/*" multiple>
            <small class="form-text">Max 5 images. Size limit: 5MB each. Allowed formats: JPG, PNG, GIF</small>
          </div>
          
          <div id="imagePreviewContainer" class="d-flex flex-wrap gap-2 mt-2"></div>
          
          <h3 class="mt-4">Pickup Information</h3>
          
          <div class="form-group">
            <label for="pickupStreet" class="form-label">Street Address <span class="text-danger">*</span></label>
            <input type="text" id="pickupStreet" name="pickupStreet" class="form-control" required value="<%= user.address.street %>">
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="pickupCity" class="form-label">City <span class="text-danger">*</span></label>
                <input type="text" id="pickupCity" name="pickupCity" class="form-control" required value="<%= user.address.city %>">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="pickupState" class="form-label">State/Province <span class="text-danger">*</span></label>
                <input type="text" id="pickupState" name="pickupState" class="form-control" required value="<%= user.address.state %>">
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="pickupPostalCode" class="form-label">Postal Code <span class="text-danger">*</span></label>
                <input type="text" id="pickupPostalCode" name="pickupPostalCode" class="form-control" required value="<%= user.address.postalCode %>">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="pickupCountry" class="form-label">Country <span class="text-danger">*</span></label>
                <input type="text" id="pickupCountry" name="pickupCountry" class="form-control" required value="<%= user.address.country %>">
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="pickupInstructions" class="form-label">Pickup Instructions</label>
            <textarea id="pickupInstructions" name="pickupInstructions" class="form-control" rows="2" placeholder="Any special instructions for pickup (e.g., 'Ring bell #2', 'Call upon arrival')"></textarea>
          </div>
          
          <h4 class="mt-3">Availability for Pickup <span class="text-danger">*</span></h4>
          <div id="availability-container">
            <div class="availability-row form-group">
              <div class="row">
                <div class="col-md-4">
                  <select name="availability" class="form-control" required>
                    <option value="">Select Day</option>
                    <option value="Monday|">Monday</option>
                    <option value="Tuesday|">Tuesday</option>
                    <option value="Wednesday|">Wednesday</option>
                    <option value="Thursday|">Thursday</option>
                    <option value="Friday|">Friday</option>
                    <option value="Saturday|">Saturday</option>
                    <option value="Sunday|">Sunday</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <input type="time" class="form-control from-time" required>
                </div>
                <div class="col-md-3">
                  <input type="time" class="form-control to-time" required>
                </div>
              </div>
            </div>
          </div>
          
          <button type="button" id="add-availability" class="btn btn-outline-secondary mt-2">
            <i class="fas fa-plus"></i> Add More Availability
          </button>
          
          <div class="form-group mt-4">
            <button type="submit" class="btn btn-primary btn-lg">Create Food Listing</button>
            <a href="/donor/foods" class="btn btn-outline-secondary">Cancel</a>
          </div>
        </div>
        
        <div class="col-md-5">
          <div class="card">
            <div class="card-body">
              <h3 class="card-title"><i class="fas fa-lightbulb text-warning"></i> Tips for Good Listings</h3>
              <ul>
                <li><strong>Clear Title:</strong> Be specific about what you're offering</li>
                <li><strong>Detailed Description:</strong> Include ingredients, freshness, and any allergens</li>
                <li><strong>Accurate Expiry:</strong> When will the food no longer be safe to consume?</li>
                <li><strong>Quality Photos:</strong> Add clear images to help receivers identify the food</li>
                <li><strong>Flexible Pickup:</strong> Provide multiple time slots if possible</li>
                <li><strong>Safety First:</strong> Ensure food is properly stored and handled</li>
              </ul>
              
              <div class="alert alert-success mt-3">
                <h4><i class="fas fa-heart"></i> Thank You!</h4>
                <p>Your generosity is making a difference in reducing food waste and helping those in need.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Update time inputs to modify the hidden input value
    const updateAvailabilityValues = () => {
      document.querySelectorAll('.availability-row').forEach(row => {
        const daySelect = row.querySelector('select');
        const fromTime = row.querySelector('.from-time').value;
        const toTime = row.querySelector('.to-time').value;
        
        if (daySelect.value && fromTime && toTime) {
          const baseValue = daySelect.value.split('|')[0] + '|';
          daySelect.value = baseValue + fromTime + '-' + toTime;
        }
      });
    };
    
    // Add event listeners to all time inputs
    document.querySelectorAll('.from-time, .to-time').forEach(input => {
      input.addEventListener('change', updateAvailabilityValues);
    });
    
    // Update values before form submission
    document.querySelector('form').addEventListener('submit', updateAvailabilityValues);
  });
</script>

<%- include('../partials/footer') %>
